(function(e,t,n){"use strict";var r=e.event,i,s;i=r.special.debouncedresize={setup:function(){e(this).on("resize",i.handler)},teardown:function(){e(this).off("resize",i.handler)},handler:function(e,t){var n=this,o=arguments,u=function(){e.type="debouncedresize";r.dispatch.apply(n,o)};if(s){clearTimeout(s)}t?u():s=setTimeout(u,i.threshold)},threshold:150};var o=e(t),u=t.Modernizr;e.BookBlock=function(t,n){this.$el=e(n);this._init(t)};e.BookBlock.defaults={speed:1e3,easing:"ease-in-out",shadows:true,shadowSides:.2,shadowFlip:.1,perspective:1300,circular:false,nextEl:"",prevEl:"",autoplay:false,interval:3e3,keyboard:true,onEndFlip:function(e,t,n){return false},onBeforeFlip:function(e){return false}};e.BookBlock.prototype={_init:function(t){this.options=e.extend(true,{},e.BookBlock.defaults,t);this.$el.css("perspective",this.options.perspective);this.$items=this.$el.children(".bb-item");this.itemsCount=this.$items.length;this.current=0;this.previous=-1;this.$current=this.$items.eq(this.current).show();this.elWidth=this.$el.width();var n={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};this.transEndEventName=n[u.prefixed("transition")]+".bookblock";this.support=u.csstransitions&&u.csstransforms3d;this._initEvents();if(this.options.autoplay){this.options.circular=true;this._startSlideshow()}},_initEvents:function(){var t=this;if(this.options.nextEl!==""){e(this.options.nextEl).on("click.bookblock",function(){t._action("next");return false})}if(this.options.prevEl!==""){e(this.options.prevEl).on("click.bookblock",function(){t._action("prev");return false})}if(this.options.keyboard==true){e(document).keydown(function(e){var n=e.keyCode||e.which,r={left:37,up:38,right:39,down:40};switch(n){case r.left:t._action("prev");break;case r.right:t._action("next");break}})}o.on("debouncedresize",function(){t.elWidth=t.$el.width()})},_action:function(e,t){this._stopSlideshow();this._navigate(e,t)},_navigate:function(e,t){if(this.isAnimating){return false}this.options.onBeforeFlip(this.current);this.isAnimating=true;this.$current=this.$items.eq(this.current);if(t!==n){this.current=t}else if(e==="next"){if(!this.options.circular&&this.current===this.itemsCount-1){this.end=true}else{this.previous=this.current;this.current=this.current<this.itemsCount-1?this.current+1:0}}else if(e==="prev"){if(!this.options.circular&&this.current===0){this.end=true}else{this.previous=this.current;this.current=this.current>0?this.current-1:this.itemsCount-1}}this.$nextItem=!this.options.circular&&this.end?this.$current:this.$items.eq(this.current);if(!this.support){this._layoutNoSupport(e)}else{this._layout(e)}},_layoutNoSupport:function(e){this.$items.hide();this.$nextItem.show();this.end=false;this.isAnimating=false;var t=e==="next"&&this.current===this.itemsCount-1||e==="prev"&&this.current===0;this.options.onEndFlip(this.previous,this.current,t)},_layout:function(e){var t=this,n=this._addSide("left",e),r=this._addSide("middle",e),i=this._addSide("right",e),s=n.find("div.bb-overlay"),o=r.find("div.bb-flipoverlay:first"),u=r.find("div.bb-flipoverlay:last"),a=i.find("div.bb-overlay"),f=this.end?400:this.options.speed;this.$items.removeAttr("style");this.$el.prepend(n,r,i);r.css({transition:"all "+f+"ms "+this.options.easing}).on(this.transEndEventName,function(n){if(n.target.className==="bb-page"){t.$el.children("div.bb-page").remove();t.$nextItem.show();t.end=false;t.isAnimating=false;var r=e==="next"&&t.current===t.itemsCount-1||e==="prev"&&t.current===0;t.options.onEndFlip(t.previous,t.current,r)}});if(e==="prev"){r.css({transform:"rotateY(-180deg)"})}if(this.options.shadows&&!this.end){var l=e==="next"?{transition:"opacity "+this.options.speed/2+"ms "+"linear"+" "+this.options.speed/2+"ms"}:{transition:"opacity "+this.options.speed/2+"ms "+"linear",opacity:this.options.shadowSides},c=e==="next"?{transition:"opacity "+this.options.speed/2+"ms "+"linear"}:{transition:"opacity "+this.options.speed/2+"ms "+"linear"+" "+this.options.speed/2+"ms",opacity:this.options.shadowFlip},h=e==="next"?{transition:"opacity "+this.options.speed/2+"ms "+"linear"+" "+this.options.speed/2+"ms",opacity:this.options.shadowFlip}:{transition:"opacity "+this.options.speed/2+"ms "+"linear"},p=e==="next"?{transition:"opacity "+this.options.speed/2+"ms "+"linear",opacity:this.options.shadowSides}:{transition:"opacity "+this.options.speed/2+"ms "+"linear"+" "+this.options.speed/2+"ms"};o.css(c);u.css(h);s.css(l);a.css(p)}setTimeout(function(){var n=e==="next"?"rotateY(-180deg)":"rotateY(0deg)";if(t.end){n=e==="next"?"rotateY(-15deg)":"rotateY(-165deg)"}r.css({transform:n});if(t.options.shadows&&!t.end){o.css({opacity:e==="next"?t.options.shadowFlip:0});u.css({opacity:e==="next"?0:t.options.shadowFlip});s.css({opacity:e==="next"?t.options.shadowSides:0});a.css({opacity:e==="next"?0:t.options.shadowSides})}},30)},_addSide:function(t,n){var r;switch(t){case"left":r=e('<div class="bb-page"><div class="bb-back"><div class="bb-outer"><div class="bb-content" style="width:'+this.elWidth+'px"><div class="bb-inner">'+(n==="next"?this.$current.html():this.$nextItem.html())+'</div></div><div class="bb-overlay"></div></div></div></div>').css("z-index",102);break;case"middle":r=e('<div class="bb-page"><div class="bb-front"><div class="bb-outer"><div class="bb-content" style="left:'+ -this.elWidth/2+"px;width:"+this.elWidth+'px"><div class="bb-inner">'+(n==="next"?this.$current.html():this.$nextItem.html())+'</div></div><div class="bb-flipoverlay"></div></div></div><div class="bb-back"><div class="bb-outer"><div class="bb-content" style="width:'+this.elWidth+'px"><div class="bb-inner">'+(n==="next"?this.$nextItem.html():this.$current.html())+'</div></div><div class="bb-flipoverlay"></div></div></div></div>').css("z-index",103);break;case"right":r=e('<div class="bb-page"><div class="bb-front"><div class="bb-outer"><div class="bb-content" style="left:'+ -this.elWidth/2+"px;width:"+this.elWidth+'px"><div class="bb-inner">'+(n==="next"?this.$nextItem.html():this.$current.html())+'</div></div><div class="bb-overlay"></div></div></div></div>').css("z-index",101);break}return r},_startSlideshow:function(){var e=this;this.slideshow=setTimeout(function(){e._navigate("next");if(e.options.autoplay){e._startSlideshow()}},this.options.interval)},_stopSlideshow:function(){if(this.options.autoplay){clearTimeout(this.slideshow);this.options.autoplay=false}},next:function(){this._action("next")},prev:function(){this._action("prev")},jump:function(e){e-=1;if(e===this.current||e>=this.itemsCount||e<0){return false}this._action(e>this.current?"next":"prev",e)},isActive:function(){return this.isAnimating},update:function(){var e=this.$items.eq(this.current);this.$items=this.$el.children(".bb-item");this.itemsCount=this.$items.length;this.current=e.index()}};var a=function(e){if(t.console){t.console.error(e)}};e.fn.bookblock=function(t){var n=e.data(this,"bookblock");if(typeof t==="string"){var r=Array.prototype.slice.call(arguments,1);this.each(function(){if(!n){a("cannot call methods on bookblock prior to initialization; "+"attempted to call method '"+t+"'");return}if(!e.isFunction(n[t])||t.charAt(0)==="_"){a("no such method '"+t+"' for bookblock instance");return}n[t].apply(n,r)})}else{this.each(function(){if(n){n._init()}else{n=e.data(this,"bookblock",new e.BookBlock(t,this))}})}return n}})(jQuery,window)